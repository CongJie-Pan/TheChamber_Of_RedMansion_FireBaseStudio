/*================ 封面頁設定 =================*/
// 封面頁
#let university = "國立臺灣師範大學"
#let academic_year = "115 學年度碩士班考試入學"
#let department = "資訊教育研究所"
#let doc_type = "【專題報告書】"
#let applicant_name = "潘驄杰"
#let applicant_group = "AI 教育與數位學習組"

// 封面頁設定
#page(header: none, numbering: none)[
  #set text(font: ("Noto Serif TC", "Noto Serif CJK TC", "Source Han Serif TC", "Times New Roman", "SimSun"), weight: "black")
  #align(center)[
    #v(2cm)
    // Logo 圖片（包含校徽和校名書法字）
    #image("logo/ntnu_logo_B814.png", width: 50%)

    #v(1cm)
    #text(size: 18pt)[#academic_year]

    #v(0.8cm)
    #text(size: 20pt)[#department]

    #v(1.5cm)
    #text(size: 22pt)[#doc_type]
  ]

  #v(1fr)  // 彈性空間推到底部

  #align(left)[
    #text(size: 14pt)[
      申請考生：#applicant_name

      申請系所與組別： #applicant_group
    ]
  ]
  #v(2cm)
]

/*================ 文件格式設定 =================*/

// 文件格式設定，設定紙張大小為A4，邊距為2.5cm，頁碼為1，頁眉為空
#set page(
  paper: "a4",
  margin: (left: 2.5cm, right: 2.5cm, top: 2.5cm, bottom: 2.5cm),
  numbering: "1",
  header: [
    #set align(center)
    #text(10pt, university + " " + department + " 專題報告書")
    #line(length: 100%)
  ]
)

// 設定字體 - 優先使用楷體系列
#set text(
  font: ("Times New Roman", "STKaiti", "SimSun", "Microsoft JhengHei UI"),
  size: 12pt,
  lang: "zh",
  region: "TW"
)

// 設定段落格式為兩端對齊，行距為0.8em，首行縮排為2em
#set par(
  justify: true,
  leading: 0.8em,
  first-line-indent: 2em
)

// 根本性解決首行縮排問題 - 強制所有段落都有首行縮排
#show par: it => {
  // 確保每個段落都有正確的首行縮排設定
  set par(first-line-indent: 2em, justify: true, leading: 0.8em)
  it
}

// 特別處理標題後的段落，強制重置段落狀態
#show heading: it => {
  it
  // 在標題後添加一個空段落來重置狀態
  v(0pt)
  par()[#text(size: 0pt)[#h(0pt)]]
}

// 特別處理列表後的段落，確保首行縮排
#show list: it => {
  it
  // 在列表後添加重置段落狀態的機制
  v(0pt)
  par()[#text(size: 0pt)[#h(0pt)]]
}

#show enum: it => {
  it
  // 在列表後添加重置段落狀態的機制
  v(0pt)
  par()[#text(size: 0pt)[#h(0pt)]]
}

// 設定列表樣式 - 數字標號和列點都內縮兩個字元
#set list(indent: 2em, body-indent: 0.5em)
#set enum(indent: 2em, body-indent: 0.5em)



/*================ 標題樣式設定 =================*/

// 設定標題樣式
#set heading(numbering: (..nums) => {
  let level = nums.pos().len()
  if level == 1 {
    // 第一級標題：壹、貳、參...
    let chinese_nums = ("壹", "貳", "參", "肆", "伍", "陸", "柒", "捌", "玖", "拾")
    chinese_nums.at(nums.pos().at(0) - 1) + "、"
  } else if level == 2 {
    // 第二級標題：一、二、三...
    let chinese_nums = ("一", "二", "三", "四", "五", "六", "七", "八", "九", "十")
    chinese_nums.at(nums.pos().at(1) - 1) + "、"
  } else if level == 3 {
    // 第三級標題：(一)、(二)、(三)...
    let chinese_nums = ("一", "二", "三", "四", "五", "六", "七", "八", "九", "十")
    "(" + chinese_nums.at(nums.pos().at(2) - 1) + ")、"
  } else if level == 4 {
    // 第四級標題：1、2、3...
    str(nums.pos().at(3)) + "、"
  } else {
    // 第五級標題：(1)、(2)、(3)...
    "(" + str(nums.pos().at(4)) + ")、"
  }
})

// 設定一級標題樣式，一級標題前換頁，標題上方空隙0.5em，標題下方空隙0.3em
#show heading.where(level: 1): it => {
  pagebreak(weak: true)  // 一級標題前換頁
  v(0.5em)  // 標題上方空隙
  set text(size: 16pt, weight: "bold")
  it
  v(0.3em)  // 標題下方空隙
}

// 設定二級標題樣式，二級標題上方空隙0.3em，標題下方空隙0.2em
#show heading.where(level: 2): it => {
  v(0.3em)  // 標題上方空隙
  set text(size: 14pt, weight: "bold")  
  it
  v(0.2em)  // 標題下方空隙
}

// 設定三級標題樣式，三級標題上方空隙0.2em，標題下方空隙0.1em
#show heading.where(level: 3): it => {
  v(0.2em)  // 標題上方空隙
  set text(size: 12pt, weight: "bold")
  it
  v(0.1em)  // 標題下方空隙
}

// 設定四級標題樣式，四級標題上方空隙0.1em，標題下方空隙0.05em
#show heading.where(level: 4): it => {
  set text(size: 12pt, weight: "bold")
  it
  // 在四級標題後添加重置段落狀態的機制
  v(0pt)
  par()[#text(size: 0pt)[#h(0pt)]]
}

// 設定五級標題樣式
#show heading.where(level: 5): it => {
  set text(size: 12pt, weight: "bold")
  h(2em) + it  // 縮一個排（2em）
  // 在五級標題後添加重置段落狀態的機制
  v(0pt)
  par()[#text(size: 0pt)[#h(0pt)]]
}

/*================ 目錄頁設定 =================*/

// 目錄頁設定
#pagebreak()
#set page(numbering: "i")
#counter(page).update(1)

#align(center)[
  #text(size: 18pt, weight: "bold")[總目錄]
]

#v(1cm)

#show outline.entry.where(level: 1): it => {
  v(0.5em, weak: true)
  set text(size: 14pt, weight: "bold")
  it
}

#show outline.entry.where(level: 2): it => {
  set text(size: 14pt, weight: "bold")
  h(1em) + it
}

#outline(
  title: none,
  indent: auto,
  depth: 3
)

/*================ 圖表目錄 =================*/

// 設定圖表編號格式
#show figure: it => {
  set figure(numbering: (..nums) => {
    if it.kind == image {
      // 圖片編號：圖一、圖二...
      let chinese_nums = ("一", "二", "三", "四", "五", "六", "七", "八", "九", "十", 
                         "十一", "十二", "十三", "十四", "十五", "十六", "十七", "十八", "十九", "二十",
                         "二十一", "二十二", "二十三", "二十四", "二十五", "二十六", "二十七", "二十八", "二十九", "三十")
      "圖" + chinese_nums.at(nums.pos().at(0) - 1) + "、"
    } else if it.kind == table {
      // 表格編號：表一、表二...
      let chinese_nums = ("一", "二", "三", "四", "五", "六", "七", "八", "九", "十")
      "表" + chinese_nums.at(nums.pos().at(0) - 1) + "、"
    } else {
      numbering(it.numbering, ..nums)
    }
  })
  it
  // 在圖表後添加重置段落狀態的機制，確保下一段落有首行縮排
  v(0pt)
  par()[#text(size: 0pt)[#h(0pt)]]
}

#align(center)[
  #text(size: 18pt, weight: "bold")[圖目錄]
]

#v(1cm)

#show outline.entry.where(level: 1): it => {
  v(1.5em, weak: true)
  set text(size: 20pt)
  strong(it)
}

#show outline.entry.where(level: 2): it => {
  set text(size: 20pt)
  h(1em) + it
}

#outline(
  target: figure.where(kind: image),
  title: none,
  indent: auto,
  depth: 5
)

#v(0.8cm)

#align(center)[
  #text(size: 18pt, weight: "bold")[表目錄]
]

#v(1cm)

#outline(
  target: figure.where(kind: table),
  title: none,
  indent: auto,
  depth: 3
)

/*================ 正文頁設定 =================*/

// 正文頁設定
#pagebreak()
#set page(numbering: "1")
#counter(page).update(1)

/*=============================================================*/

= 緒論

《紅樓夢》作為中國古典文學的巔峰之作，承載著深厚的文化內涵與精神底蘊，
不僅是文學經典，更是理解華人文化圈的核心入口。透過閱讀《紅樓夢》，我們能夠獲得三點重要啟發：
第一，人性洞察的深度體驗，讓讀者在寶玉的頑皮、黛玉的孤高、熙鳳的精明中看見、感受到身邊人際的真實面貌，讓我們能更加理解人心；第二，華人社會深層邏輯的透徹理解，從賈府的自給自足與小圈子文化中領悟華人社會運作的根本規律；第三，語言藝術的極致美感，在登峰造極的文字與富有哲思的詩詞中培養中文美感與表達的簡潔精煉。

掌握《紅樓夢》的文化精髓，等同於同時獲得人性觀察、社會認知與語言美學的三重修養，成為解讀中華文化思維模式與價值體系的關鍵鑰匙。然而，傳統教學模式往往將這部經典簡化為「考試範圍」或「知識背誦」，導致學生無法真正體會其文化精髓，並且當代讀者在古典文學閱讀中面臨三大核心困境，而止步於前：

1. 學習動力難以持續：讀者因缺乏即時回饋與明確學習里程碑，導致學習進度無法追蹤、成就感嚴重不足，最終選擇中途放棄。
2. 理解門檻過高：古文詞彙艱澀難懂、人物關係錯綜複雜，加上文化背景陌生，造成嚴重的閱讀障礙與故事內容情感疏離。
3.社群討論機會缺乏：傳統閱讀往往是孤獨的個人體驗，讀者難以找到志同道合的討論對象，無法交流心得、碰撞觀點，缺乏同儕激勵與多元視角啟發，導致學習過程單調乏味、思考深度受限。

因此「紅樓慧讀」應運而生，提出三點創新解決方案：

(一) 動機維持系統：遊戲化學習設計
針對持續動機問題，系統採用遊戲化設計將閱讀轉化為成就解鎖體驗。建立「閱讀成就徽章系統」，設置「初窺門第」、「人物通曉」、「詩詞雅趣」等里程碑，配備精美視覺與儀式感。「進度視覺化追蹤」透過動態環形進度條、學習熱力圖等元素，讓用戶清楚掌握學習狀態。「個人化目標設定」根據用戶時間能力提供客製化學習計畫，智能調整難度確保挑戰性與可達成性平衡。

(二) AI智能輔助系統：知識圖譜生成與閱讀頁面AI問答
針對理解門檻過高問題，本系統提出兩個解決方案。其一，於閱讀頁面中，利用GraphJudge技術(Huang, H., et al.2025)由文本轉成互動式圖譜，實現章節內容自動知識圖譜生成功能，供用戶了解每章回的脈絡所在。其二，於閱讀頁面中嵌入AI問答功能，供用戶可以即時選內文做詢問，得到具有來源的回答。

(三) 社群互動系統：共讀社群營造
針對較缺乏社群討論機會之問題，本系統建立完整的社群互動機制。設置「紅學社」討論區，以類似社群媒體發文的方式，用戶可以按讚、留言來表達此文的感受，促進讀者間的思想交流與觀點碰撞。並且讀者亦可分享閱讀時的筆記，在紅學社進一步與用戶共享、討論意見心得。最後，用戶可以建立話題標籤(例如："紅樓夢第一回的神話意旨")，來為話題分類，供其他用戶做篩選參考。

未來將持續擴展社群功能，加入讀書會組隊、隊友共同任務等機制。透過紅學社，本系統將孤獨閱讀轉化為充滿互動的共學體驗，讓讀者在多元觀點碰撞中深化理解與思辨能力。

/*=============================================================*/

= 需求與市場分析

== 需求分析

「紅樓慧讀」系統的核心用戶群體為「有古典文學基礎但缺乏持續學習動力的學習者」，這一群體具備一定古典文學接觸經驗，對《紅樓夢》等經典名著有基本認知，但在實際閱讀過程中普遍面臨「讀了幾回就停止」的現象。

基於梁寧《產品思維課程》的用戶需求分析框架，古典文學閱讀中的用戶需求分為三個層次。核心痛點是持續學習動力缺失，表現為「害怕再次半途而廢」的恐懼心理，具體包括缺乏明確學習里程碑與成就感回饋機制、無法有效追蹤學習進度與掌握程度、缺少外部激勵與持續動力維持機制，以及對長篇古典文學的時間投入產生焦慮。重要痛點是理解障礙與文化隔閡，源於語言的時代隔閡、文化背景的斷層、人物關係的複雜性，以及缺乏專業解讀的引導。重要爽點體現在理解突破的即時滿足，包括即時詞義解析、AI智能問答的快速回應、視覺化人物圖譜的清晰認知，以及權威專家解讀帶來的深度理解滿足感。輔助癢點則是文化身份認同需求，滿足用戶對文化素養提升與社會認同的渴望。

根據需求優先級分析，核心功能需求包括動機維持系統（閱讀成就徽章系統、學習進度可視化追蹤、個人化目標設定機制）和理解輔助工具（上下文感知詞義解析系統、AI智能問答模組、互動式人物關係圖譜、權威專家解讀內容整合）。重要功能需求包括AI語音朗讀功能和設計為輔助性質的社群互動功能，支援「主要獨立閱讀，偶爾參與討論」的用戶偏好。

== 市場與競爭者分析

古典文學閱讀市場呈現多元化的解決方案格局，現有競爭者可分為三大類別(參下表)：

#figure(
  table(
    columns: (1.5fr, 1.5fr, 2fr, 2fr),
    align: (left + horizon, left + horizon, left + horizon, left + horizon),
    stroke: 0.5pt,
    table.header(
      [*競爭者類別*], [*代表產品*], [*主要功能特色*], [*核心限制*]
    ),
    
    // 第一類：傳統紙質書籍與基礎電子書平台
    [*傳統紙質書籍與基礎電子書平台*],
    [四大名著合集：閱讀四大古典名著全集],
    [1.基本文白對照\     2.簡單註釋功能\
     3.書籤保存\
     4.進度記錄],
    [1.缺乏深度解析\
     2.無互動性設計\
     3.無法維持持續閱讀動力],
    
    // 第二類：進階古典文學閱讀工具
    table.cell(rowspan: 4)[*進階古典文學閱讀工具*],
    [讀典籍APP],
    [按句文白對照],
    [1.主要集中語言翻譯層面\
     2.缺乏深度解析與互動性],
    
    [古文島APP],
    [1.細緻分類系統\
     2.豐富內容],
    [1.僅有詩詞內容\
     2.缺乏趣味性],
    
    [詩雲APP],
    [1.專注詩詞欣賞\
     2.良好視聽體驗],
    [內容範圍有限],
    
    [識典古籍],
    [原文與古籍圖片對照],
    [1.回目有所缺漏\
     2.內容並不完整],
    
    // 第三類：知識服務平台與通用學習工具
    [*知識服務平台與通用學習工具*],
    [得到APP],
    [1.標準電子書格式\
     2.基礎AI朗讀服務\
     3.學習記錄追蹤\
     4.多領域專家課程],
    [1.缺乏古典文學相關功能(例如文白對照、即時註解、知識圖譜)\
     2.專家資源分散\
     3.未針對台灣地區優化]
  ),
  caption: [古典文學閱讀市場競爭者分析],
  kind: table
)

因此相較於現有競爭者，「紅樓慧讀」建立了四個關鍵領域的差異化競爭優勢，分別為：

#figure(
  table(
    columns: (1.5fr, 3fr),
    align: (left + horizon, left + horizon),
    stroke: 0.5pt,
    table.header(
      [*差異化優勢領域*], [*具體內容*]
    ),
    
    [*完整的動機維持生態系統*],
    [針對現有競品普遍缺失的核心功能，建立遊戲化學習機制與成就系統。],
    
    [*AI系統性融合的技術創新*],
    [首創基於AI的章節知識圖譜自動生成系統，智能解析文本結構與人物關係。],
    
    [*專業內容資源整合*],
    [建立涵蓋名家解讀、知識圖譜的完整體系，提供系統性古典文學專家解讀。],
    
    [*情感定位與品牌價值* ],
    [將閱讀體驗定位為溫暖的心靈避風港，滿足現代人對文化認同與心靈滋養的深層需求。]
  ),
  caption: [「紅樓慧讀」差異化競爭優勢],
  kind: table
)

== 商業模式

「紅樓慧讀」採用「三級火箭+流量為王」的網路商業策略，目標在兩年內成為全台灣古典文學學習的流量入口，再透過多元化變現實現商業價值。商業邏輯遵循「先建立流量壟斷，後實現規模變現」的策略思維，前期專注用戶規模快速增長，不急於變現。

第一級火箭以「免費工具獲取流量」為核心理念，專注於建立台灣最大的古典文學閱讀流量池。系統提供完整《紅樓夢》原文閱讀器、智能人物關係圖譜、學習進度追蹤系統、基礎筆記分享功能、社群交流功能，以及紅樓夢閱讀時之AI問答服務。此階段目標是在第一年累積10萬註冊用戶。整個過程完全免費，透過解決古典文學閱讀痛點快速獲取用戶，建立產品不可替代性。

第二級火箭透過「智能平台提升黏性」策略建立用戶深度依賴。系統開始提供進階AI問答系統、學習成就系統。此階段仍以免費為主，部分進階功能開始引入輕度付費，主要目的是建立用戶對平台的深度依賴。此階段目標是在第一年累積20萬註冊用戶。

第三級火箭在用戶規模達到關鍵質量時啟動。為學校提供客製化教學解決方案，先與北一女中建立合作關係，成為指定學習工具，提供教師專用功能，支援課程教學和學生管理。此階段目標是在第一年累積30萬註冊用戶。

在推廣流量方面，社群流量戰略利用抖音、Instagram等平台進行內容行銷，與文學KOL和教師網紅合作擴大影響力範圍，設計病毒式分享機制鼓勵用戶主動傳播。SEO流量戰略搶佔「紅樓夢」、「古典文學」等核心關鍵字，建立內容資料庫提升搜索引擎排名，與教育和文化網站建立外鏈合作。

= 系統分析與設計

== 用戶流程圖

#figure(
  image("systemGraph\FlowChart\UserFlow\userFlowChart_ActualSystem_20251204.jpg", width: 90%),
  caption: [紅樓夢閱讀學習系統:用戶流程圖]
)

該用戶流程圖描述了用戶由進入系統至結束系統的完整步驟。首先，用戶進入介紹頁面後，面臨身份選擇的決策點。系統提供三種認證路徑：新用戶可選擇「註冊帳號」建立個人檔案；既有用戶直接「登入」進入系統；而希望快速體驗的用戶則可選擇「訪客登入」，無需註冊即可使用核心功能。

無論選擇哪個認證路徑，用戶最終都會進入系統的核心控制中心——Dashboard 學習總覽頁面。此頁面呈現用戶的學習狀態、閱讀進度與整體成就概覽。

進入 Dashboard 後，用戶面臨「選擇功能」的關鍵決策點，系統提供四大主要功能入口：

第一，「閱讀頁面」(/read-page) 是系統的核心閱讀功能，提供沉浸式的《紅樓夢》閱讀體驗。在此頁面中，用戶可以進行閱讀、向 AI 即時問答獲得解答、選取內文記錄與編輯筆記、查看章節知識圖譜，以及切換章節、調整字體與主題等個人化設定。

第二，「每日修身」(/daily-tasks) 是系統的遊戲化學習核心，透過每日任務機制維持用戶學習動力。系統提供三種任務類型：閱讀理解測驗、詩詞品質評析、人物性格分析，完成任務可獲得經驗值並提升等級，形成持續的學習激勵循環。

第三，「紅學社」(/community) 是社群互動功能，讓用戶能夠發表心得（發文）、參與討論（評論）、以及按讚互動，形成學習社群的知識分享氛圍。

第四，「成就模組」(/achievements) 負責追蹤用戶的學習成果，包含查看已獲得的徽章、設定個人學習目標，以及檢視詳細的學習統計數據。

完成任一功能的使用後，系統設計了完善的循環機制來維持用戶的學習連續性。通過「繼續使用」的決策點，用戶可以選擇返回 Dashboard 繼續探索其他功能，形成完整的學習閉環。當用戶完成學習任務或希望離開系統時，可以選擇登出，完成整個用戶流程。

== 系統架構圖

#figure(
  image("systemGraph\StuctureGraph\structureGraph_actualSystem.jpg", width: 100%),
  caption: [紅樓夢閱讀學習系統:系統架構圖]
)


首先，在系統的前端介面層，採用 Next.js 15 App Router 架構，以「首頁（Dashboard）」作為核心導航中樞。用戶可透過「介紹頁面」了解系統功能後，再經由「登入註冊頁面」使用 NextAuth.js 進行身份驗證。成功登入後進入首頁，可選擇五大核心功能：「閱讀頁面」提供沉浸式閱讀體驗與 AI 問答功能、「成就閱覽頁面」展示學習成果與激勵機制、「每日任務頁面」提供遊戲化學習挑戰、「討論互動社區頁面」促進用戶間的討論交流，以及「個人帳號設定頁面」管理用戶個人資料與偏好設定。

接下來，API 服務層透過 API 閘道器（API Gateway）統一管理所有來自前端的請求。API 閘道器負責請求路由、認證驗證與流量控制，將請求分發至對應的後端服務模組進行處理，確保系統的安全性與可擴展性。

之後，後端服務層共包含十一個核心服務模組，分為業務服務層與資料存取層：

*業務服務層（七個服務）：*

1. *用戶登入註冊認證服務*：使用 NextAuth.js 實現用戶身份驗證，支援 Credentials Provider 進行帳號密碼登入與訪客模式。

2. *原文閱讀／筆記服務*：處理章節文本載入、閱讀進度追蹤，以及用戶筆記的建立與管理功能。

3. *AI 問答服務*：整合 Perplexity Sonar Reasoning API，提供具備網路搜尋能力的智能問答功能，支援串流回應以提升用戶體驗。

4. *每日任務服務*：管理每日學習任務的完整生命週期，包括任務生成、提交評估、連續學習天數追蹤。

5. *成就系統服務*：管理用戶經驗值計算、等級提升、成就徽章解鎖與獎勵分發。

6. *知識圖譜服務（章回圖譜）*：提供章節知識圖譜資料的讀取與呈現，展示紅樓夢各章回的人物關係與情節脈絡。

7. *社群互動服務*：支援貼文發布、留言互動、按讚功能，促進用戶間的學習交流。

*資料存取與輔助服務層（四個服務）：*

8. *AI 評分服務*：整合 OpenAI GPT-5-mini，負責所有每日任務的評分與回饋生成，包括閱讀理解、詩詞賞析、人物分析等。

9. *用戶基本資料存取*：管理用戶帳戶、等級、經驗值與個人設定資訊的 CRUD 操作。

10. *用戶內容資料存取*：處理用戶產生的內容資料，包括筆記、貼文、留言與閱讀進度的存取管理。

11. *知識資料存取*：管理紅樓夢原文、章節資訊與知識圖譜資料的讀取服務。

此外，*不良內容過濾服務*作為獨立的安全模組，自動檢測不當內容、髒話、仇恨言論與個資洩露，確保平台內容品質與社群安全。
*資料庫採用「紅樓夢知識庫」作為單一儲存解決方案*，該知識庫包含圖譜資料與所有業務資料。透過 better-sqlite3 進行連線管理，這種設計大幅簡化了開發與部署的複雜性，同時整合了紅樓夢的知識圖譜結構，支援章回人物關係的視覺化呈現。

最後，系統整合三項關鍵外部服務以增強功能性：
1. *Perplexity API（AI 問答＋網路搜尋）*：提供具備網路搜尋能力的 AI 問答服務，讓用戶在閱讀時可以即時詢問與紅樓夢相關的問題，並獲得包含學術文獻引用的專業回答。

2. *OpenAI API GPT-5-mini（AI 評分）*：負責所有學習任務的 AI 評分，包括閱讀理解、詩詞賞析、人物分析等任務類型的智能評估與回饋生成。

3. *GraphJudge 技術連接 LLM 自動生成圖譜系統（預生成圖譜）*：運用 GraphJudge 技術預先生成紅樓夢各章回的知識圖譜，將人物關係、情節發展與文學元素結構化，提供系統知識圖譜服務的資料來源。

== 資料庫設計

#figure(
  rotate(90deg, origin: center, reflow: true)[
    #image("systemGraph/ERD/ERD_Summary.jpg", width: 91%)
  ],
  caption: [該系統主要資料表之ERD圖]
)

// Mermaid ERD Code（實際資料庫設計 - 8個核心表）
// ```mermaid
// erDiagram
//     users ||--o{ daily_progress : "擁有"
//     users ||--o{ task_submissions : "提交"
//     users ||--o{ highlights : "標註"
//     users ||--o{ notes : "撰寫"
//     users ||--o{ posts : "發文"
//     users ||--o{ comments : "評論"
//
//     daily_tasks ||--o{ task_submissions : "被評分"
//     posts ||--o{ comments : "包含"
//     comments ||--o{ comments : "回覆"
//     notes |o--o| posts : "分享為"
//
//     users {
//         TEXT id PK "UUID主鍵"
//         TEXT username "用戶名稱"
//         TEXT email UK "電子郵件"
//         INTEGER currentLevel "當前等級"
//         INTEGER currentXP "當前經驗值"
//         INTEGER totalXP "累計經驗值"
//         TEXT attributes "JSON技能屬性"
//         TEXT stats "JSON學習統計"
//         INTEGER createdAt "建立時間戳"
//     }
//
//     daily_tasks {
//         TEXT id PK "UUID主鍵"
//         TEXT taskType "任務類型"
//         TEXT difficulty "難度等級"
//         TEXT title "任務標題"
//         INTEGER baseXP "基礎經驗值"
//         TEXT content "JSON任務內容"
//     }
//
//     daily_progress {
//         TEXT id PK "userId_date格式"
//         TEXT userId FK "用戶外鍵"
//         TEXT date "日期YYYY-MM-DD"
//         TEXT completedTaskIds "JSON已完成任務"
//         INTEGER totalXPEarned "當日獲得XP"
//         INTEGER streak "連續天數"
//     }
//
//     task_submissions {
//         TEXT id PK "UUID主鍵"
//         TEXT userId FK "用戶外鍵"
//         TEXT taskId FK "任務外鍵"
//         TEXT userAnswer "用戶答案"
//         INTEGER score "AI評分0-100"
//         TEXT feedback "AI回饋"
//     }
//
//     highlights {
//         TEXT id PK "UUID主鍵"
//         TEXT userId FK "用戶外鍵"
//         INTEGER chapterId "章節編號"
//         TEXT selectedText "選取文字"
//     }
//
//     notes {
//         TEXT id PK "UUID主鍵"
//         TEXT userId FK "用戶外鍵"
//         INTEGER chapterId "章節編號"
//         TEXT note "筆記內容"
//         TEXT tags "JSON標籤陣列"
//         INTEGER isPublic "是否公開"
//         TEXT sharedPostId FK "分享貼文ID"
//     }
//
//     posts {
//         TEXT id PK "UUID主鍵"
//         TEXT authorId FK "作者外鍵"
//         TEXT title "貼文標題"
//         TEXT content "貼文內容"
//         INTEGER likes "按讚數"
//         INTEGER commentCount "評論數"
//         TEXT sourceNoteId FK "來源筆記ID"
//     }
//
//     comments {
//         TEXT id PK "UUID主鍵"
//         TEXT postId FK "貼文外鍵"
//         TEXT authorId FK "作者外鍵"
//         TEXT content "評論內容"
//         TEXT parentCommentId FK "父評論ID"
//         INTEGER depth "巢狀深度"
//     }
// ```
// 備註：系統另有 xp_transactions、xp_transaction_locks、level_ups 三個輔助表用於經驗值追蹤與等級提升紀錄

==== 實體 (Entities)

實際資料庫設計採用 SQLite 作為儲存方案，共包含十一個資料表，可分為四大類別：

1. *用戶核心*：*users* 表是整個系統的核心，儲存用戶帳戶、等級進度、經驗值與學習統計等資訊，代表使用平台的學習者。

2. *學習系統*：包含 *daily_tasks*（每日任務定義）、*daily_progress*（每日學習進度追蹤）與 *task_submissions*（任務提交與 AI 評分記錄）三表，實現每日學習任務的完整生命週期管理，包括任務生成、分配、提交與智能評估。

3. *閱讀輔助*：*highlights*（文本標註）與 *notes*（用戶筆記）兩表支援閱讀過程中的互動標記與知識整理功能，其中筆記可設為公開以分享至社群。

4. *社群互動*：*posts*（社群貼文）與 *comments*（評論）兩表構成完整的社群討論系統，評論表支援無限層級的巢狀回覆。此外，筆記與貼文之間建立雙向連結，實現閱讀心得到社群分享的無縫轉換。

系統另有 *xp_transactions*、*xp_transaction_locks*、*level_ups* 三個輔助表用於經驗值交易審計與等級提升事件追蹤，確保遊戲化機制的資料完整性。章節內容（《紅樓夢》原文）則以 JSON 檔案形式儲存於 `/src/data/chapterGraph/` 目錄，採用靜態資料分離策略。

==== 屬性 (Attributes)

所有主要資料表皆使用 TEXT 類型的 UUID 作為主鍵，確保全域唯一性與分散式系統的擴展性。在 SQLite 架構下，系統廣泛採用 JSON 格式儲存複雜資料結構，包括：users 表的 `attributes`（技能屬性：poetrySkill, culturalKnowledge, analyticalThinking）與 `stats`（學習統計）欄位、notes 與 posts 表的 `tags`（標籤陣列）欄位、以及 posts 表的 `likedBy`（按讚用戶列表）欄位等。此設計減少了關聯查詢的複雜性，同時保持資料的靈活性。

時間戳記統一採用 Unix 毫秒格式（INTEGER 類型），確保跨時區的一致性。users 表包含完整的遊戲化屬性（currentLevel, currentXP, totalXP），daily_progress 表則使用複合主鍵格式（userId_date）追蹤每日學習狀態與連續學習天數（streak）。task_submissions 表儲存 AI 評分（score: 0-100）與回饋文字（feedback），實現智能評估的結果持久化。

==== 關係 (Relationships)

資料庫關係設計以 users 表為核心，放射狀連接各功能模組。users 表與 daily_progress、task_submissions、highlights、notes、posts、comments 六表建立一對多關係，體現用戶是所有系統活動的主體。

在學習系統中，daily_tasks 與 task_submissions 建立一對多關係，記錄同一任務被不同用戶提交評分的完整軌跡。社群系統中，posts 與 comments 建立一對多關係，而 comments 表透過 parentCommentId 欄位實現自我關聯，支援無限層級的巢狀回覆結構，depth 欄位記錄當前評論的巢狀深度。

值得特別說明的是筆記與貼文之間的雙向連結設計：notes 表的 sharedPostId 外鍵指向由該筆記分享而成的貼文，而 posts 表的 sourceNoteId 外鍵則指向貼文的來源筆記。此設計實現了閱讀筆記一鍵分享至社群的功能，同時保留完整的溯源關係。

==== 基數 (Cardinality)

系統中主要採用一對多（1:N）關係模式，確保資料結構的穩定性與查詢效率。每位用戶可以擁有：多筆每日學習進度（daily_progress）、多次任務提交（task_submissions）、多個文本標註（highlights）、多篇筆記（notes）、多篇貼文（posts）與多則評論（comments），完整體現用戶作為系統核心的設計理念。

comments 表的自我關聯是一種特殊的一對多模式變體：每則評論可以有零至多個子回覆（透過 parentCommentId），而每則回覆只能有一個父評論，形成樹狀結構。此設計搭配 depth 欄位，支援任意深度的討論串展示與摺疊。

notes 與 posts 之間採用可選的一對一關係（0..1:0..1）：一篇筆記可以選擇分享為一篇貼文，而一篇貼文也可能來源於一篇筆記，但此關聯並非強制。這種靈活設計允許用戶自由選擇是否將私人筆記公開分享至社群。

== 前端介面設計

==== 介紹頁

#figure(
  image("UiPicture/introductionPage/introductionPage.png", width: 90%),
  caption: [介紹頁面]
)

來到「紅樓慧讀」的介紹頁，映入眼簾的，是融合紅樓夢中，傳統中國紅與雅致金色的主視覺設計，旨在營造溫暖而富有文化底蘊的氛圍。簡潔的導航欄置於頂部，包含「主頁」、「特色」及「主要功能」等核心區塊的快速入口，並提供中英文切換選項，確保您能順暢地探索本站。

向下滾動，將首先深入了解閱讀經典時常遇到的「挑戰」，我們以圖文並茂的卡片形式，清晰呈現讀者痛點。緊接著，「紅樓慧讀的智能方案」區塊則詳細闡述了我們如何運用資訊技術克服這些障礙，每一項解決方案都配有精心設計的圖標和簡明扼要的說明。最後，頁面底部的行動呼籲區塊，以醒目的按鈕邀請您「免費註冊」，開啟您的智慧閱讀之旅。頁腳部分則提供了關於我們與競賽的相關資訊，整體設計力求在傳遞信息的同時，保持視覺上的雅緻與和諧。

==== 登入與註冊頁面

#grid(
  columns: 2,
  gutter: 1em,
  figure(
    image("UiPicture/RegisterLoginPage/LoginPage.jpg", width: 100%),
    caption: [登入頁面]
  ),
  figure(
    image("UiPicture/RegisterLoginPage/RegisterPage_1.jpg", width: 100%),
    caption: [註冊頁面(填寫基本資訊)]
  )
)

#grid(
  columns: 2,
  gutter: 1em,
  figure(
    image("UiPicture/RegisterLoginPage/RegisterPage_2.jpg", width: 100%),
    caption: [註冊頁面(簡單選填古典文學能力基礎)]
  ),
  figure(
    image("UiPicture/RegisterLoginPage/RegisterPage_3.jpg", width: 100%),
    caption: [註冊頁面(填寫對紅樓夢感興趣之處)]
  )
)

#figure(
  image("UiPicture/RegisterLoginPage/RegisterPage_4.jpg", width: 55%),
  caption: [註冊頁面(填寫使用本平台的用途)]
)

註冊流程採用了沉浸式的分步設計，將帳戶創建與個人化資訊收集分解為簡潔的獨立頁面。每一頁都聚焦於單一或少量相關的資訊輸入，從基礎的帳號密碼，到學習背景、閱讀興趣及目標，引導用戶逐步完成。視覺上，註冊卡片延續了應用程式典雅的中國風配色與清晰的排版，確保了品牌一致性與閱讀舒適度。透過明確的步驟指示與便捷的前後導航按鈕，我們致力於提供一個流暢、直觀且無壓力的註冊體驗。

==== 首頁

#figure(
  image("UiPicture/mainPage/mainPage_1.jpg", width: 100%),
  caption: [首頁(上半部)]
)

#figure(
  image("UiPicture/mainPage/mainPage_2.jpg", width: 100%),
  caption: [首頁(下半部)]
)

用戶首頁以清晰的卡片式佈局，為學習者提供一個即時的學習狀態總覽，一目了然當前的閱讀進度與整體成就。最上方顯著的學習進度概覽區，以動態的環形進度條展示《紅樓夢》章回完成度，並輔以多個小型數據卡片，如平均理解度、總學習時長等關鍵指標。緊隨其後的是「最近閱讀活動」區塊，採用橫向滾動的書本卡片陳列，方便快速返回上次的閱讀章節或相關的專家解讀。此外，頁面還會展示設定的個人學習目標列表，並以視覺化方式標記已達成和待完成的項目，持續激勵您的學習動力。整體設計延續了應用的典雅中國風，運用溫暖的色調與精緻的圖標，營造出一個既美觀又實用的個人化學習中心。

==== 閱讀頁面
#figure(
  image("UiPicture/ReadingPage/ReadingPage_ChoosingBook_originalText.png", width: 100%),
  caption: [書架(紅樓夢原文)]
)

#figure(
  image("UiPicture/ReadingPage/ReadingPage_ChoosingBook_expertText.png", width: 100%),
  caption: [書架(專家解讀內容)]
)

「我的書架」頁面採用了清晰直觀的卡片式設計，能輕鬆管理與選擇《紅樓夢》的閱讀資源。頁面頂部通過醒目的「我的書架」標題和選項卡（Tabs）來組織內容，將書籍清晰地劃分為「紅樓夢原文」、「專家解讀」以及「最近學習」三大類別。在每個類別下，用戶可以利用「全部」、「進度」和「分類」等篩選按鈕快速定位書籍，而每本書籍則以獨立的「書籍卡片」形式展示，卡片上包含書本圖標佔位符、書名、作者、簡介以及一個直達閱讀界面的「閱讀」按鈕，整體佈局採用響應式網格，確保在各種設備上均有良好的瀏覽體驗。

在「紅樓夢原文」部分，我們彙集了《紅樓夢》的不同版本，如庚辰本、程甲本等，方便您進行對比閱讀或選擇偏好的版本進行深入研讀，並以「電子書」標籤加以區分。而在「專家解讀」部分，則收錄了如蔣勳、白先勇等學者的權威解讀著作，幫助用戶從多個視角理解這部經典的深層內涵與藝術成就。


#figure(
  image("UiPicture/ReadingPage/readingPage_White.png", width: 100%),
  caption: [閱讀頁面(預設白色主題)顯示白話文功能開啟]
)

#figure(
  image("UiPicture/ReadingPage/readingPage_Green.png", width: 100%),
  caption: [閱讀頁面(綠色主題)選取文字顯示文字工作欄位]
)

#figure(
  image("UiPicture/ReadingPage/readingPage_Black.png", width: 90%),
  caption: [閱讀頁面(黑色主題)寫筆記功能]
)

#figure(
  image("UiPicture/ReadingPage/readingPage_Yellow.png", width: 90%),
  caption: [閱讀頁面(黃色主題)問AI功能]
)

該閱讀頁面致力於打造一個沉浸式且高度個人化的《紅樓夢》研讀環境。一進入頁面，頂部會呈現一個智能顯隱的工具欄，不僅清晰標示當前章回標題，還集成了返回、目錄以及全螢幕切換等基本導航。更核心的是，它提供了豐富的自訂選項，讀者可以根據偏好調整閱讀背景主題（如白、黃、護眼綠及夜間模式）、選擇包括思源宋體在內的多種字體、無級調整字號大小，並能將文本在單欄、雙欄或三欄佈局間自由切換，以達到最佳閱讀舒適度。正文區域則清晰呈現古典原文，同時允許用戶選擇性開啟或關閉並列的白話文翻譯，對於文中的疑難詞彙或典故，則以小巧的彈出式註解提供即時解釋，確保閱讀的流暢性。

為了深化理解與互動，閱讀頁面整合了多種智能輔助工具。當用戶選取任意文本段落時，會浮現一個快捷操作欄，提供「寫筆記」、「複製」、「問 AI」等功能；「寫筆記」會拉出側邊面板，讓用戶記錄與選文相關的思考，而「問 AI」則能針對選定內容，向特化的《紅樓夢》AI模型提問並獲得解答。此外，頁面還設有獨立的面板來展示當前章回的「知識圖譜」，將人物、事件、概念間的關係視覺化，並提供完整的「目錄」以便在各章回間快速跳轉。這些精心設計的互動功能，旨在將傳統的文本閱讀轉化為一次富有探索性的學習旅程。

==== 成就系統功能
#figure(
  image("UiPicture/achievementPage/achievementPage_1.jpg", width: 90%),
  caption: [成就頁面：顯示獲得的成就]
)

#figure(
  image("UiPicture/achievementPage/achievementPage_2.jpg", width: 90%),
  caption: [成就頁面：學習進度總覽]
)

#figure(
  image("UiPicture/achievementPage/achievementPage_3.jpg", width: 90%),
  caption: [成就頁面：目標顯示與自行設定目標]
)

#figure(
  image("UiPicture/achievementPage/achievementPage_4.jpg", width: 90%),
  caption: [成就頁面：學習挑戰賽]
)

「成就與目標」頁面是「紅樓慧讀」中激勵用戶持續學習的核心空間，整體採用清晰的卡片式佈局，將用戶的學習成果與未來規劃直觀呈現。頁面首先以「我獲得的成就」區塊迎接用戶，將每一個達成的里程碑——無論是完成特定章回閱讀，還是連續登入學習——都化為一枚枚帶有專屬圖標、詳細描述及獲得日期的精緻徽章卡片，並輔以分類標籤，讓學習成就一目了然且富有儀式感。

接著，頁面通過「學習進度總覽」模塊，以數據化方式展現用戶的整體投入，例如總閱讀時長、已完成章回數、筆記數量以及連續學習天數等，並配備醒目的總體進度條，讓用戶對自己的學習軌跡有宏觀的把握。與此同時，「下一步目標」與「設定新的學習目標」兩個區域緊密相連，前者展示系統推薦或用戶正在進行的目標，並以進度條追蹤完成情況；後者則提供多個快捷按鈕，引導用戶根據自身需求，自主設定如每日閱讀時長、章回完成數等個性化學習計畫。

為了進一步提升互動性與參與感，「學習挑戰賽」模塊以選項卡形式整合了每日、每週及特殊主題挑戰，鼓勵用戶參與社群活動，贏取額外獎勵。

==== 知識圖譜頁面
以下為參考Github「KGQA：基於知識圖譜的《紅樓夢》人物關係可視化及問答系統」一專案#super[①]，的介面設計，會參考使用其專案納入專題中實作，作為知識圖譜頁面的主要部分。於圖二十七，用戶可以在搜尋欄輸入紅樓夢角色名字，或是點擊輸入欄下方的名字，即會顯示如左側該位角色的關係圖譜。而後，於圖二十八，顯示總人物關係圖譜的頁面。於上方顏色標籤，可透過點擊決定是否查看該顏色系列人物關係。
#figure(
  image("UiPicture/knowledgeGraphPage/knowledgeGraph_mainPage.jpg", width: 100%),
  caption: [知識圖譜頁面：人物檢索]
)

#figure(
  image("UiPicture/knowledgeGraphPage/knowledgeGraph_allCharactorPage.jpg", width: 100%),
  caption: [知識圖譜頁面：總人物圖譜]
)

#line(length: 100%)

---
① https://github.com/chizhu/KGQA_HLM

==== 紅學社：社群功能頁面
#figure(
  image("UiPicture/communityPage/communityPage.png", width: 90%),
  caption: [社群功能頁面]
)

「紅學社」頁面致力於打造一個充滿活力的《紅樓夢》愛好者交流空間，整體採用卡片式佈局，方便用戶瀏覽與互動。頁面頂部設有清晰的「紅學社」標題及功能說明，緊接著是一個便捷的搜索框，讓用戶可以快速查找感興趣的發文內容、作者或標籤。已登入的用戶會看到一個簡潔的發文表單，鼓勵他們分享自己的閱讀心得與見解。

下方則以信息流的形式展示所有發文，每一篇發文都是一個獨立的卡片，包含作者、時間戳、可展開的完整內容、相關標籤，並集成了點讚、評論按鈕；點擊評論後，會展開評論區，用戶不僅能看到他人留下的評論，還能親自參與討論，發表自己的看法，形成一個圍繞《紅樓夢》主題的互動學習與分享園地。




== 使用技術

「紅樓慧讀」系統採用現代化的全端架構設計，以Next.js 15作為核心開發框架，結合雙AI模型整合策略與雲端資料庫解決方案，打造高效能、易維護的古典文學學習平台。整體技術選型以開發效率、用戶體驗和成本效益為核心考量，確保系統能夠快速迭代並提供優質的學習體驗。

==== 前端技術核心架構

系統前端採用Next.js 15作為核心開發框架，充分利用其App Router架構實現檔案基礎的路由系統，簡化頁面組織和導航邏輯。Next.js提供伺服器端渲染（SSR）和靜態網站生成（SSG）能力，確保優異的首次載入效能和搜尋引擎優化效果。系統同時運用React Server Components技術，在伺服器端預先處理資料獲取，減少客戶端JavaScript負擔，提升整體效能表現。自動程式碼分割和延遲載入功能進一步優化打包檔案大小，使用戶能夠快速存取所需功能。

React 18作為用戶介面開發的核心函式庫，提供宣告式元件開發模式和強大的狀態管理能力。系統廣泛運用React Hooks（useState、useEffect、useCallback、useRef）進行狀態邏輯封裝，並透過自訂Hooks實現可重用的業務邏輯模組。React Context API負責管理全域狀態，包括認證狀態（AuthContext）和語言偏好設定（LanguageContext），確保跨元件的資料共享與同步。

TypeScript作為主要開發語言，提供靜態型別檢查和智能程式碼補全功能，大幅降低開發過程中的錯誤率並提升程式碼的可維護性。搭配Zod資料驗證函式庫，系統在執行期間對API請求和表單輸入進行嚴格的資料格式驗證，確保前後端資料介面的一致性和安全性。開發團隊能夠在編譯時期即時發現潛在問題，減少生產環境的錯誤發生率。

用戶介面設計採用Tailwind CSS 3.4作為核心樣式框架，透過實用優先（utility-first）的設計理念，實現快速且一致的視覺風格開發。Tailwind CSS的原子化CSS類別系統支援響應式設計和暗色模式切換，確保系統在不同裝置和使用環境下都能提供最佳的視覺體驗。配合PostCSS進行樣式最佳化處理，有效減少最終打包檔案的大小，提升頁面載入速度。

元件庫整合Shadcn UI作為基礎UI元件解決方案，提供33個以上高品質、可重用的用戶介面元件。Shadcn UI基於Radix UI無障礙元件庫和Tailwind CSS構建，確保所有互動元件都符合現代Web標準。系統中的按鈕、對話框、下拉選單、手風琴面板、標籤頁等互動元件都支援鍵盤導航和螢幕閱讀器，提升整體用戶體驗的包容性和可訪問性。

狀態管理與資料獲取採用TanStack React Query 5.x進行優化，提供智能快取、背景資料更新、樂觀更新等進階功能。React Query的快取機制有效減少重複API請求，同時保持資料的即時性。針對AI問答等需要較長處理時間的功能，系統設計專門的載入狀態處理機制，透過ThinkingProcessIndicator元件為用戶提供即時的處理進度回饋。

==== 後端核心技術架構

系統後端採用Next.js API Routes作為核心技術，實現前後端整合的全端開發模式。相較於傳統的微服務架構，此設計大幅簡化了部署流程和維護成本，同時保持良好的程式碼組織結構。每個API端點都以獨立檔案形式存在於/src/app/api/目錄下，遵循RESTful設計原則，提供清晰的介面定義。

認證系統採用NextAuth.js 4.24作為核心解決方案，實作Credentials Provider進行電子郵件與密碼認證。系統採用JWT（JSON Web Token）無狀態會話機制，標準會話時效為24小時，啟用「記住我」功能時可延長至30天。密碼安全採用bcryptjs進行雜湊處理，確保用戶憑證的安全儲存。系統同時支援訪客登入功能，讓用戶能夠在不註冊的情況下體驗核心功能。

資料驗證層採用Zod Schema驗證函式庫，對所有API請求進行嚴格的輸入驗證。每個API端點都定義明確的請求參數Schema，在處理邏輯執行前先行驗證資料格式和型別，有效防止惡意輸入和資料格式錯誤。錯誤處理採用統一的回應格式，提供清晰的錯誤訊息和HTTP狀態碼，便於前端進行相應處理。

服務層架構採用Repository Pattern設計模式，將資料存取邏輯封裝於/src/lib/repositories/目錄下的專門模組中。此設計實現業務邏輯與資料庫操作的清晰分離，所有資料庫查詢都使用參數化準備陳述式（Prepared Statements），有效防止SQL注入攻擊。系統包含用戶資料、學習進度、每日任務、筆記、社群貼文等多個資料存取模組，每個模組都提供完整的CRUD操作介面。

==== 資料庫與儲存系統

系統採用Turso LibSQL作為雲端資料庫解決方案，這是一種基於SQLite的分散式資料庫服務。Turso提供低延遲的邊緣複製能力，確保全球各地用戶都能獲得快速的資料存取體驗。相較於傳統的PostgreSQL等關聯式資料庫，LibSQL在保持SQL標準相容性的同時，大幅降低了運維複雜度和成本。

資料庫架構設計包含11個核心資料表，涵蓋用戶管理、學習進度追蹤、每日任務系統、社群互動等完整功能。用戶資料表儲存帳戶資訊、經驗值、等級和學習偏好設定；每日任務相關資料表追蹤任務生成、提交和評分歷程；社群資料表管理貼文、評論和互動記錄。所有資料表都採用UUID作為主鍵，確保全域唯一性和系統擴展性。

資料存取層採用非同步API模式，透過 libsql/client函式庫與Turso服務進行通訊。系統配置TURSO_DATABASE_URL和TURSO_AUTH_TOKEN環境變數進行安全連線，所有資料庫操作都透過execute()非同步方法執行。Schema初始化在應用程式啟動時自動完成，確保資料庫結構的一致性。

==== 人工智慧技術

系統的AI功能採用雙模型整合策略，針對不同任務類型選用最適合的大型語言模型。此設計充分發揮各模型的專長，同時控制API使用成本，實現效能與成本的最佳平衡。

OpenAI GPT-5-mini負責所有評分與批改任務，包括每日閱讀理解評估、詩詞品質評析、人物性格分析評分、文化測驗批改和評註詮釋評量。GPT-5-mini以其穩定的JSON結構化輸出能力和精確的評分一致性，成為教育評量場景的理想選擇。系統透過精心設計的Prompt模板，引導模型依據明確的評分標準進行評量，並生成包含分數、評語和改進建議的結構化回饋。API整合採用OpenAI官方SDK，配置60秒請求超時和2次自動重試機制，確保服務穩定性。

Perplexity Sonar API負責問答與分析任務，特別是需要網路搜尋能力的上下文分析功能。Perplexity API以其強大的即時資訊檢索功能，能夠將用戶問題與《紅樓夢》特定章節內容、當代學術研究成果相結合，生成具有深度學術價值的個性化解答。系統整合Perplexity的串流回應功能，透過Server-Sent Events（SSE）技術實現即時回應顯示，讓用戶在等待完整回答的同時就能看到部分內容。引用處理模組自動解析API回傳的來源資訊，為用戶提供可驗證的學術引用。

針對《紅樓夢》古典文學的特殊語境，系統設計專門的Prompt Engineering策略。所有AI提示詞都以繁體中文撰寫，明確指定模型角色為紅學專家，並提供章節上下文和用戶閱讀歷程作為背景資訊。系統包含品質評估機制，當AI回應不符合預期格式時，自動觸發重試或降級處理，確保用戶體驗的一致性。

==== 知識圖譜可視化

知識圖譜可視化採用D3.js 7.9作為核心技術，這是JavaScript生態系統中最強大的資料視覺化函式庫。系統運用D3.js的Force Simulation演算法實現自然的節點佈局計算，透過forceLink（連接約束）、forceManyBody（節點斥力）、forceCenter（中心引力）和forceCollide（碰撞避免）等力學模擬，創造出視覺上平衡且易於理解的人物關係網絡圖。

知識圖譜資料結構包含節點（Nodes）和連結（Links）兩大類型。節點類型涵蓋人物（character）、地點（location）、概念（concept）、事件（event）和器物（artifact），每個節點都標記重要性等級（主要、次要、第三級）以決定視覺呈現大小。連結類型包含家族關係、友誼關係、衝突關係、文學關聯和概念關聯，每條連結都具有強度值（0-1）以決定線條粗細和距離。

互動功能方面，系統支援縮放（0.1倍至3倍）、平移和節點拖曳操作，用戶可以自由探索複雜的人物關係網絡。節點搜尋功能允許用戶快速定位特定人物，搜尋結果會以高亮效果標示。視覺設計採用傳統中國風配色方案，透過色彩編碼區分不同類型的實體和關係，營造與平台整體風格一致的美學體驗。

圖譜資料透過/api/chapters/[chapterNumber]/graph端點動態載入，系統同時提供本地JSON檔案作為降級方案。針對LLM處理延遲，系統設計專門的載入狀態處理，在圖譜生成過程中為用戶提供進度指示。

==== 開發與測試工具

系統採用現代化的開發工具鏈，確保程式碼品質和開發效率。ESLint 9.x配合eslint-config-next規則集進行程式碼靜態分析，自動檢測潛在問題和風格不一致。TypeScript 5.x的嚴格模式確保型別安全，所有程式碼都必須通過npm run typecheck驗證才能合併至主分支。

測試框架採用Jest 29.x搭配Testing Library生態系統，提供完整的單元測試和元件測試能力。測試套件目前包含164個以上測試案例，整體測試覆蓋率達77.37%，關鍵服務模組如內容過濾服務達91.51%覆蓋率。測試策略涵蓋正常情境、邊界條件和錯誤處理，確保系統在各種場景下的穩定性。

Repository層測試採用記憶體SQLite資料庫（:memory:）進行隔離測試，每個測試案例都在獨立的資料庫實例中執行，避免測試間的資料干擾。AI服務測試透過Jest Mock機制模擬外部API回應，確保測試可重複執行且不產生實際API費用。

版本控制採用Git，開發流程遵循功能分支工作流。每次程式碼變更都需要通過自動化測試驗證，確保主分支的穩定性。系統支援Vercel平台部署，實現持續整合和持續部署（CI/CD）的自動化流程。



== 時程規劃：甘特圖

#figure(
  image("miscellaneous/ProjectTimeGanttChart.png", width: 100%),
  caption: [專案時程規劃(圖中紅色為製圖今日線6月3日)]
)

在規劃階段 (Planning)，我們將進行主題與動機的研究，時間範圍為2025年2月1日至2025年5月15日。在此期間，我們將確定專案的方向和研究動機，並進行需求調研。

接下來是分析與設計階段 (Analysis & Design)，這一階段的時間為2025年5月20日至2025年6月15日，主要內容包括系統架構的設計和需求分析。

在工作流程階段 (Workflow)，我們將於2025年5月20日至2025年6月15日進行工作流程的規劃，制定開發流程和協作方式。

隨後進入前端開發階段 (UI/Frontend)，這一階段的時間為2025年5月1日至2025年6月15日，將專注於用戶介面的設計和前端功能的實作。

接著是後端開發階段 (Backend)，時間範圍為2025年6月16日至2025年9月30日，主要內容為核心業務邏輯和資料庫的設計實作。

在測試階段 (Testing)，我們將於2025年10月1日至2025年10月15日進行測試與品質保證，內容包括功能測試、整合測試和效能測試。

最後是發布階段 (Release)，這一階段的時間為2025年10月16日至2025年12月31日，將進行系統的上線和後續的維護支援。

= 系統使用對象

「紅樓慧讀」系統針對三大核心用戶群體設計差異化功能體驗。

(一) 主要目標用戶：古典文學學習者、文化愛好者
具古典文學基礎但缺乏持續學習動力的用戶群體，核心痛點為「害怕半途而廢」的恐懼心理，缺乏明確學習里程碑與持續激勵機制。系統透過遊戲化徽章系統、進度視覺化追蹤、個人化目標設定等完整動機維持生態，將「恐懼轉化為期待」，建立可持續學習習慣。

針對文學愛好者、紅樓夢文化研究者，提供專家解讀深度整合（白先勇、歐麗娟、蔣勳、董梅）、高級學術討論區、文化脈絡拓展資料。鼓勵成為知識貢獻者和社群導師，透過專家用戶認證與內容共創機制，形成「專業引領、大眾參與」的良性生態。

(二) 教育用戶群體：教師與學生
而後，若系統初期順利運營，則會深入教育領域，為高中國文教育設計專門功能，教師端提供教學輔助工具包：課程管理、學習成效分析儀表板、知識圖譜教學演示、學習數據分析等。學生端強化互動體驗：班級學習社群、同儕作品觀摩評論、學習競賽模式等，透過結構化教學和同儕互動提升學習效果。並先與台灣一流高中進行試營運合作，例如北一女中(因為團隊成員有朋友曾於北一女中讀書方便聯繫該校教師。) 

= 系統貢獻與未來展望

== 系統貢獻

（一）打造沉浸式學習環境，讓學生成為文化世界的主動探索者
本系統透過「遊戲化機制 + AI智能輔助 + 社群互動」三大功能整合，建立完整沉浸式學習生態。遊戲化機制：例如，成就徽章系統、等級制度等，增加學生學習的成就感。

AI智能輔助理解：當遇到難懂詩句時，「問AI」功能以LLM提供具來源的解讀，並且提供「章節知識圖譜」，將每章複雜劇情關係視覺化，幫助學生自主理解賈府小圈子文化。社群互動：「討論互動社群頁面」讓學生持續思考交流不同議題，在觀點碰撞中培思考。學生不再被動接受知識，而是在系統支持下深度自主學習，真正「活在」《紅樓夢》的文化中。

（二）賦能教師角色轉型，從知識傳遞者升級為學習引導者
本系統亦旨在解放教師，當系統承擔基礎知識解答與進度追蹤等工作後，教師得以從「講述者」轉型為「引導者」。教師透過學習分析儀表板掌握學生狀況，將課堂時間用於發起深度討論、引導批判思考、分享生命經驗與文本連結，實踐真正的「轉譯」——將古典智慧轉化為當代學生可理解的人生洞察。這種轉型讓教師升級為「思想點燃者」，實現教育本質價值。

未來規劃與台灣高中合作試營運，透過教育現場的實證回饋持續優化功能，期望「紅樓慧讀」能成為推動國文教育數位轉型的示範平台，讓學生不只學習《紅樓夢》，更從中獲得理解華人文化圈與現代人際關係的關鍵能力，實現從「被動背誦」到「主動體驗」的教育典範轉移。

== 未來展望

首先，在平台普及化方面，我們計劃開發手機APP版本，讓「紅樓慧讀」能夠觸及更廣泛的用戶群體。行動裝置的普及使得學習能夠隨時隨地進行，透過APP的推出，我們將為用戶提供更便利的學習途徑，突破時空限制，讓古典文學閱讀真正融入生活節奏中。同時，我們也將持續引入AI語音模型優化古文朗讀品質，拓展學習情境的沉浸感與可及性。

其次，在教育合作發展方面，我們將優先與高中端建立合作關係，目前已鎖定北一女中作為首要合作對象。憑藉團隊與北一女中的同學有既有聯繫關係，我們將開發專門的教學版本，分別針對教師端和學生端設計差異化功能。教師端將提供教學輔助工具、課程管理功能和學習成效分析儀表板，協助老師更有效地進行古典文學教學；學生端則將強化互動學習體驗和同儕作品觀摩評論功能，讓高中生能夠得到同儕更多元的意見。

在內容發展上，我們將擴充名家解讀庫、引入用戶共創機制，鼓勵用戶貢獻高品質學習筆記與文學見解，進一步強化平台的社群價值與知識深度，實現「共學、共創、共讀」的社群學習目標。同時，我們將建立用戶個人品牌經營機制，讓有影響力的用戶能夠建立自己的學術聲譽和追蹤者社群。透過讓熱門多追蹤數的用戶帶領其餘小用戶，形成真正的社群效應，創造知識分享與傳播的正向循環，讓優質的學習內容和見解能夠在社群中自然傳播和累積。


= 參考文獻
1.	Carlson, C. R. (2017). SRI’s turnaround: how four principles guided high-value,marketcreating innovation. Strategy & Leadership, 45(3), 3-11. https://doi.org/10.1108/SL-052017-0052
2.	鄒欣（2019）。《構建之法：現代軟件工程》（第三版）。北京：人民郵電出版社。
3.	SRI International. (n.d.). NABC Value Proposition. Retrieved from https://www.sri.com
4.	Huang, H., Chen, C., Sheng, Z., Li, Y., & Zhang, W. (2024). Can LLMs be Good Graph Judge for Knowledge Graph Construction? arXiv preprint arXiv:2411.17388. https://doi.org/10.48550/arXiv.2411.17388
5.	廖俊雲（2024）。《元宇宙營銷：數字營銷新浪潮》。北京：北京大學出版社。
6.	黃勁松（2024）。《數字營銷學》。北京：機械工業出版社。
7.	楊雪（2024）。《電子商務：商業模式、戰略與運營》。北京：機械工業出版社。
8.	戴維·羅斯（2016）。《極致：互聯網時代的產品設計》。北京：中信出版社。



